import{O as J}from"./OrganizationLayout-e59c3130.js";import{q as K}from"./index-d20420be.js";import{I as k,J as q,aa as T,i as r,o as s,c as _,w as l,a as p,b as i,d as c,h as f,f as d,t as m,F as h,C as Q,N as X,k as z,e as O}from"./app-78468d3b.js";import{_ as Z}from"./_plugin-vue_export-helper-c27b6911.js";import{U as $}from"./UploadOutlined-e5283a52.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";const ee={components:{OrganizationLayout:J,quillEditor:K,dayjs:k,UploadOutlined:$},props:["competitionScores","competition","scoreCategories","staffOptions","refereeOptions","medias","categories_weights","roles"],data(){return{breadcrumb:[{label:"賽事列表",url:route("manage.competitions.index")},{label:this.competition.id?"賽事修改":"賽事新增",url:null}],mode:null,showWeightList:!1,dateFormat:"YYYY-MM-DD",dateList:["2023-01-02"],competitionData:{},uploadValidator:{banner:{size:2,format:["image/jpeg","image/png"]},attachment:{size:1,format:["image/jpeg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".doc",".docx",".xls",".xlsx"]}},rules:{competition_score_id:{required:!0},title_zh:{required:!0},period:{required:!0},match_date:{required:!0},roleSelected:{required:!0},cwSelected:{required:!0}},validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},layout:{labelCol:{span:8},wrapperCol:{span:16}},virticalStyle:{display:"flex",height:"30px",lineHeight:"30px",marginLeft:"8px"}}},mounted(){},created(){var o,a;this.competitionScores.unshift({id:0,title:"無積分"}),this.competition==null?(this.mode="CREATE",this.competitionData.roleSelected=[]):(this.mode="EDIT",this.competitionData={...this.competition},this.competitionData.period=[],this.competitionData.period[0]=k(this.competition.start_date),this.competitionData.period[1]=k(this.competition.end_date),this.competitionData.cwSelected=this.competition.categories_weights.map(n=>n.code),this.competitionData.roleSelected=this.competition.roles.map(n=>n.value),this.competitionData.staffOptionsSelected=(o=this.competition.staff_options)==null?void 0:o.map(n=>n.value),this.competitionData.refereeOptionsSelected=(a=this.competition.referee_options)==null?void 0:a.map(n=>n.value),this.getDaysArray(this.competitionData.period[0],this.competitionData.period[1]))},methods:{onCompetitionPeriodChange(){this.competitionData.match_dates=[],this.getDaysArray(this.competitionData.period[0],this.competitionData.period[1])},getDaysArray(o,a){for(var n=[],v=new Date(o);v<=new Date(a);v.setDate(v.getDate()+1))n.push(v.getFullYear()+"-"+(v.getMonth()+1)+"-"+v.getDate());this.dateList=n},beforeBannerUpload(o){var a=o.size/1024/1024>this.uploadValidator.banner.size,n=!this.uploadValidator.banner.format.includes(o.type);if(a||n)return q.error({content:()=>"檔案格式不符或大小超過限制. The file format does not match or the size exceeds the limit.",class:"custom-class",style:{marginTop:"50vh"}}),T.LIST_IGNORE},beforeAttachmentUpload(o){var a=o.size/1024/1024>this.uploadValidator.attachment.size,n=!this.uploadValidator.attachment.format.includes(o.type);if(a||n)return q.error({content:()=>"檔案格式不符或大小超過限制. The file format does not match or the size exceeds the limit.",class:"custom-class",style:{marginTop:"50vh"}}),T.LIST_IGNORE},onFinish(){this.competitionData.categories_weights=this.categories_weights.filter(o=>this.competitionData.cwSelected.includes(o.code)),this.competitionData.roles=this.roles.filter(o=>this.competitionData.roleSelected.includes(o.value)),this.competitionData.start_date=this.competitionData.period[0].format("YYYY-MM-DD"),this.competitionData.end_date=this.competitionData.period[1].format("YYYY-MM-DD"),this.mode=="CREATE"?this.$inertia.post(route("manage.competitions.store"),this.competitionData,{onSuccess:o=>{console.log(o)},onError:o=>{console.log(o)}}):(this.competitionData.referee_options=[],this.competitionData.refereeOptionsSelected.forEach(o=>this.competitionData.referee_options.push(this.refereeOptions.find(a=>a.value==o))),this.competitionData.staff_options=[],this.competitionData.staffOptionsSelected.forEach(o=>this.competitionData.staff_options.push(this.staffOptions.find(a=>a.value==o))),console.log(this.competitionData),this.competitionData._method="PATCH",this.$inertia.post(route("manage.competitions.update",this.competitionData.id),this.competitionData,{onSuccess:o=>{console.log(o)},onError:o=>{console.log(o)}}))}}},te={class:"container mx-auto"},oe={class:"bg-white relative shadow rounded-lg p-5"},ie=p("br",null,null,-1),ae={width:"100%"},le={class:"text-left"},ne={class:"align-top"},se={key:0},re=p("svg",{focusable:"false",class:"","data-icon":"delete",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896"},[p("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})],-1),ce=["src"],me={key:1},pe={key:0},ue=p("svg",{focusable:"false",class:"","data-icon":"delete",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896"},[p("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})],-1),de={key:0},fe=["src"],he={key:1},_e=["href"],ve={class:"flex flex-row item-center justify-center"};function be(o,a,n,v,t,g){const C=r("a-select"),u=r("a-form-item"),S=r("a-input"),V=r("a-textarea"),Y=r("quill-editor"),A=r("a-range-picker"),B=r("a-select-option"),D=r("a-checkbox"),F=r("a-col"),H=r("a-row"),y=r("a-checkbox-group"),I=r("a-divider"),N=r("a-typography-title"),x=r("a-typography-text"),R=r("a-card"),M=r("inertia-link"),L=r("upload-outlined"),w=r("a-button"),E=r("a-upload"),j=r("a-switch"),U=r("a-radio-button"),P=r("a-radio-group"),W=r("a-form"),G=r("OrganizationLayout");return s(),_(G,{title:n.competition.id?"賽事修改":"賽事新增",breadcrumb:t.breadcrumb},{default:l(()=>[p("div",te,[p("div",oe,[i(W,{model:t.competitionData,name:"nest-messages","validate-messages":t.validateMessages,layout:"vertical",rules:t.rules,onFinish:g.onFinish},{default:l(()=>[i(u,{label:o.$t("competition_score_category"),name:"competition_score_id"},{default:l(()=>[i(C,{value:t.competitionData.competition_score_id,"onUpdate:value":a[0]||(a[0]=e=>t.competitionData.competition_score_id=e),options:n.competitionScores,fieldNames:{value:"id",label:"title"}},null,8,["value","options"])]),_:1},8,["label"]),i(u,{label:o.$t("competition_title_zh"),name:"title_zh"},{default:l(()=>[i(S,{value:t.competitionData.title_zh,"onUpdate:value":a[1]||(a[1]=e=>t.competitionData.title_zh=e)},null,8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("competition_title_fn"),name:"title_fn"},{default:l(()=>[i(S,{value:t.competitionData.title_fn,"onUpdate:value":a[2]||(a[2]=e=>t.competitionData.title_fn=e)},null,8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("brief"),name:"brief"},{default:l(()=>[i(V,{value:t.competitionData.brief,"onUpdate:value":a[3]||(a[3]=e=>t.competitionData.brief=e),style:{"min-height":"100px"}},null,8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("description"),name:"description"},{default:l(()=>[i(Y,{value:t.competitionData.description,"onUpdate:value":a[4]||(a[4]=e=>t.competitionData.description=e),style:{"min-height":"200px"}},null,8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("competition_period"),name:"period"},{default:l(()=>[i(A,{value:t.competitionData.period,"onUpdate:value":a[5]||(a[5]=e=>t.competitionData.period=e),format:t.dateFormat,onChange:g.onCompetitionPeriodChange},null,8,["value","format","onChange"])]),_:1},8,["label"]),i(u,{label:o.$t("competition_dates"),name:"match_dates"},{default:l(()=>[i(C,{value:t.competitionData.match_dates,"onUpdate:value":a[6]||(a[6]=e=>t.competitionData.match_dates=e),mode:"multiple"},{default:l(()=>[(s(!0),c(h,null,f(t.dateList,e=>(s(),_(B,{value:e},{default:l(()=>[d(m(e),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("group"),name:"cwSelected"},{default:l(()=>[p("a",{onClick:a[7]||(a[7]=e=>t.showWeightList=!t.showWeightList),class:"float-right"},"詳細內容"),i(y,{value:t.competitionData.cwSelected,"onUpdate:value":a[8]||(a[8]=e=>t.competitionData.cwSelected=e),class:"w-full"},{default:l(()=>[i(H,{span:24},{default:l(()=>[(s(!0),c(h,null,f(n.categories_weights,e=>(s(),_(F,{span:6},{default:l(()=>[i(D,{value:e.code},{default:l(()=>[d(m(e.name),1)]),_:2},1032,["value"]),ie]),_:2},1024))),256))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),i(I),Q(i(R,null,{title:l(()=>[d(" 各級重量 ")]),default:l(()=>[p("table",ae,[p("tr",null,[(s(!0),c(h,null,f(n.categories_weights,e=>(s(),c("th",le,[i(N,{level:5},{default:l(()=>[d(m(e.name),1)]),_:2},1024)]))),256))]),p("tr",ne,[(s(!0),c(h,null,f(n.categories_weights,e=>(s(),c("td",null,[i(x,{strong:""},{default:l(()=>[d("男子組")]),_:1}),p("ol",null,[(s(!0),c(h,null,f(e.male,b=>(s(),c("li",null,m(b.name)+" : "+m(b.limit[0])+" - "+m(b.limit[1]),1))),256))]),i(x,{strong:""},{default:l(()=>[d("女子組")]),_:1}),p("ol",null,[(s(!0),c(h,null,f(e.female,b=>(s(),c("li",null,m(b.name)+" : "+m(b.limit[0])+" - "+m(b.limit[1]),1))),256))])]))),256))])])]),_:1},512),[[X,t.showWeightList]]),i(u,{label:o.$t("role"),name:"roleSelected"},{default:l(()=>[i(y,{value:t.competitionData.roleSelected,"onUpdate:value":a[9]||(a[9]=e=>t.competitionData.roleSelected=e)},{default:l(()=>[(s(!0),c(h,null,f(n.roles,e=>(s(),_(D,{style:z(t.virticalStyle),value:e.value},{default:l(()=>[d(m(e.label),1)]),_:2},1032,["style","value"]))),256))]),_:1},8,["value"])]),_:1},8,["label"]),t.competitionData.roleSelected.includes("referee")?(s(),_(u,{key:0,label:o.$t("referee_options"),name:"refereeOptionsSelected",rules:t.competitionData.roleSelected.includes("referee")?[{required:!0}]:[]},{default:l(()=>[i(y,{value:t.competitionData.refereeOptionsSelected,"onUpdate:value":a[10]||(a[10]=e=>t.competitionData.refereeOptionsSelected=e)},{default:l(()=>[(s(!0),c(h,null,f(n.refereeOptions,e=>(s(),_(D,{style:z(t.virticalStyle),value:e.value},{default:l(()=>[d(m(e.label),1)]),_:2},1032,["style","value"]))),256))]),_:1},8,["value"])]),_:1},8,["label","rules"])):O("",!0),t.competitionData.roleSelected.includes("staff")?(s(),_(u,{key:1,label:o.$t("staff_options"),name:"staffOptionsSelected",rules:t.competitionData.roleSelected.includes("staff")?[{required:!0}]:[]},{default:l(()=>[i(y,{value:t.competitionData.staffOptionsSelected,"onUpdate:value":a[11]||(a[11]=e=>t.competitionData.staffOptionsSelected=e)},{default:l(()=>[(s(!0),c(h,null,f(n.staffOptions,e=>(s(),_(D,{style:z(t.virticalStyle),value:e.value},{default:l(()=>[d(m(e.label),1)]),_:2},1032,["style","value"]))),256))]),_:1},8,["value"])]),_:1},8,["label","rules"])):O("",!0),i(u,{label:o.$t("banner_image"),name:"competition_banner"},{default:l(()=>[t.mode=="EDIT"&&n.competition.media.find(e=>e.collection_name=="competitionBanner")?(s(),c("div",se,[i(M,{href:o.route("manage.competition.deleteMedia",{type:"banner",competition_id:n.competition.id}),method:"post",as:"button",type:"button",class:"float-right text-red-500"},{default:l(()=>[re]),_:1},8,["href"]),p("img",{src:n.competition.media.find(e=>e.collection_name=="competitionBanner").preview_url},null,8,ce)])):(s(),c("div",me,[i(E,{"file-list":t.competitionData.banner,"onUpdate:fileList":a[12]||(a[12]=e=>t.competitionData.banner=e),multiple:!1,beforeUpload:g.beforeBannerUpload,"max-count":1,accept:t.uploadValidator.banner.format.toString(),"list-type":"picture",capture:null},{default:l(()=>[i(w,null,{default:l(()=>[i(L),d(" "+m(o.$t("upload_file")),1)]),_:1})]),_:1},8,["file-list","beforeUpload","accept"])]))]),_:1},8,["label"]),i(u,{label:o.$t("attachment"),name:"attachment"},{default:l(()=>[t.mode=="EDIT"?(s(),c("div",pe,[(s(!0),c(h,null,f(n.competition.media.filter(e=>e.collection_name=="competitionAttachment"),e=>(s(),c("div",null,[i(M,{href:o.route("manage.competition.deleteMedia",{type:"attachment",competition_id:n.competition.id,media_id:e.id}),method:"post",as:"button",type:"button",class:"float-right text-red-500"},{default:l(()=>[ue]),_:2},1032,["href"]),e.mime_type.includes("image")?(s(),c("div",de,[p("img",{src:e.preview_url},null,8,fe)])):(s(),c("div",he,[p("a",{href:e.original_url,target:"_blank"},m(e.file_name),9,_e)]))]))),256))])):O("",!0),p("div",null,[i(E,{"file-list":t.competitionData.attachment,"onUpdate:fileList":a[13]||(a[13]=e=>t.competitionData.attachment=e),multiple:!0,beforeUpload:g.beforeAttachmentUpload,"max-count":5,accept:t.uploadValidator.attachment.format.toString(),"list-type":"picture"},{default:l(()=>[i(w,null,{default:l(()=>[i(L),d(" "+m(o.$t("upload_file")),1)]),_:1})]),_:1},8,["file-list","beforeUpload","accept"])])]),_:1},8,["label"]),i(u,{label:o.$t("application_fee"),name:"fee"},{default:l(()=>[i(S,{value:t.competitionData.fee,"onUpdate:value":a[14]||(a[14]=e=>t.competitionData.fee=e),style:{width:"100px"}},null,8,["value"])]),_:1},8,["label"]),i(u,{label:o.$t("published"),name:"published"},{default:l(()=>[i(j,{checked:t.competitionData.published,"onUpdate:checked":a[15]||(a[15]=e=>t.competitionData.published=e),checkedValue:1,unCheckedValue:0},null,8,["checked"])]),_:1},8,["label"]),i(u,{label:o.$t("scope"),name:"scope"},{default:l(()=>[i(P,{value:t.competitionData.scope,"onUpdate:value":a[16]||(a[16]=e=>t.competitionData.scope=e),"button-style":"solid"},{default:l(()=>[i(U,{value:"PUB"},{default:l(()=>[d(m(o.$t("public")),1)]),_:1}),i(U,{value:"MJA"},{default:l(()=>[d("MJA "+m(o.$t("members")),1)]),_:1}),i(U,{value:"ORG"},{default:l(()=>[d(m(o.$t("organization_member_only")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),p("div",ve,[i(w,{type:"primary","html-type":"submit"},{default:l(()=>[d(m(o.$t("submit")),1)]),_:1})])]),_:1},8,["model","validate-messages","rules","onFinish"])])])]),_:1},8,["title","breadcrumb"])}const Ce=Z(ee,[["render",be]]);export{Ce as default};
