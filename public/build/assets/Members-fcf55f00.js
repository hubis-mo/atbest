import{O as L}from"./OrganizationLayout-e59c3130.js";import{_ as S}from"./_plugin-vue_export-helper-c27b6911.js";import{M as T,i as s,o as b,c as k,w as t,a as i,b as a,f as r,t as d,d as c,F as h,e as M,h as Y}from"./app-78468d3b.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";const $={components:{OrganizationLayout:L,PopupModal:T},props:["memberTiers","members"],data(){return{breadcrumb:[{label:"會員列表",url:null}],dateFormat:"YYYY-MM-DD",modal:{isOpen:!1,data:{},title:"Modal",mode:""},columns2:[{title:"Tier Code",dataIndex:"tier_code"},{title:"valid at",dataIndex:"valid_at"}],columns:[{title:"Given name",dataIndex:"given_name",i18n:"given_name",responsive:["md"]},{title:"Family name",dataIndex:"family_name",i18n:"family_name"},{title:"Gender",dataIndex:"gender",i18n:"gender"},{title:"Date of birth",dataIndex:"dob",i18n:"dob"},{title:"Tier",dataIndex:"tier",i18n:"tier",filters:this.memberTiers.map(e=>({value:e.label,text:e.label})),onFilter:(e,n)=>n.current_tier.tier_code===e},{title:"State",dataIndex:"state",i18n:"state"},{title:"Avatar",dataIndex:"avatar",i18n:"avatar"},{title:"Operation",dataIndex:"operation",key:"operation",i18n:"operation"}],rules:{given_name:{required:!0},family_name:{required:!0},gender:{required:!0},dob:{required:!0},email:{required:!0,type:"email"},state:{required:!0}},validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},labelCol:{style:{width:"150px"}}}},created(){},methods:{onCancelModal(){this.modal.data={},this.modal.data.current_tier={},this.modal.isOpen=!1},createRecord(){this.modal.data={},this.modal.data.current_tier={},this.modal.mode="CREATE",this.modal.title="create",this.modal.isOpen=!0},editRecord(e){this.modal.data={...e},this.modal.data.current_tier={...e.current_tier},this.modal.mode="EDIT",this.modal.title="edit",this.modal.isOpen=!0},storeRecord(){this.$refs.modalRef.validateFields().then(()=>{this.$inertia.post(route("manage.members.store"),this.modal.data,{onSuccess:e=>{this.modal.data={},this.modal.isOpen=!1},onError:e=>{console.log(e)}})}).catch(e=>{console.log(e)})},updateRecord(){this.$refs.modalRef.validateFields().then(()=>{this.$inertia.patch(route("manage.members.update",this.modal.data.id),this.modal.data,{onSuccess:e=>{this.modal.isOpen=!1,console.log(e)},onError:e=>{console.log(e)}})}).catch(e=>{console.log("error",e)})},deleteConfirmed(e){this.$inertia.delete(route("manage.members.destroy",{member:e}))},createLogin(e){axios.post(route("manage.member.createLogin",e)).then(n=>{n.data.result==!1&&T.warning({title:"Email Duplicated",content:n.data.message}),this.modal.data={},this.modal.isOpen=!1})},addTier(){this.modal.data.tiers.unshift({tier_code:null,valid_at:null,expired_at:null})},validateNotNull(e){return e.value?Promise.resolve():Promise.reject("必填欄位 Required input!")},deleteMemberTier(e,n){n.id?console.log("to delete record: "+n.id):this.modal.data.tiers.splice(e,1)}}},A={class:"flex-auto pb-3 text-right"},B={class:"container mx-auto pt-5"},V={class:"bg-white relative shadow rounded-lg overflow-x-auto"},z=["src"],P=["src"],G={class:"flex-auto pb-3 text-right"},j={class:"ant-table"},H={class:"ant-table-container pl-10 pr-10"},J={style:{"table-layout":"auto"}},K={class:"ant-table-thead"},Q={class:"text-right"},W={class:"align-top"};function X(e,n,C,Z,o,_){const p=s("a-button"),O=s("inertia-link"),F=s("a-popconfirm"),R=s("a-table"),u=s("a-form-item"),f=s("a-col"),g=s("a-row"),v=s("a-input"),w=s("a-radio-button"),x=s("a-radio-group"),y=s("a-date-picker"),N=s("a-select"),E=s("a-form"),q=s("a-modal"),D=s("OrganizationLayout");return b(),k(D,{title:e.$t("members"),breadcrumb:o.breadcrumb},{default:t(()=>[i("div",A,[a(p,{type:"primary",class:"!rounded",onClick:n[0]||(n[0]=l=>_.createRecord())},{default:t(()=>[r(d(e.$t("create_member")),1)]),_:1})]),i("div",B,[i("div",V,[a(R,{dataSource:C.members,columns:o.columns},{headerCell:t(({column:l})=>[r(d(l.i18n?e.$t(l.i18n):l.title),1)]),bodyCell:t(({column:l,text:I,record:m,index:ee})=>[l.dataIndex=="operation"?(b(),c(h,{key:0},[a(O,{href:e.route("manage.members.show",m.id),class:"ant-btn"},{default:t(()=>[r(d(e.$t("view")),1)]),_:2},1032,["href"]),a(p,{onClick:U=>_.editRecord(m)},{default:t(()=>[r(d(e.$t("edit")),1)]),_:2},1032,["onClick"]),a(F,{title:e.$t("confirm_delete_record"),"ok-text":e.$t("yes"),"cancel-text":e.$t("no"),onConfirm:U=>_.deleteConfirmed(m.id)},{default:t(()=>[a(p,null,{default:t(()=>[r(d(e.$t("delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm"]),a(p,{onClick:U=>_.createLogin(m.id),disabled:m.user!=null},{default:t(()=>[r(d(e.$t("create_login")),1)]),_:2},1032,["onClick","disabled"])],64)):l.dataIndex=="tier"&&m.current_tier?(b(),c(h,{key:1},[r(d(m.current_tier.tier_code),1)],64)):l.dataIndex=="avatar"?(b(),c("img",{key:2,src:m.avatar_url,width:"60"},null,8,z)):(b(),c(h,{key:3},[r(d(m[l.dataIndex]),1)],64))]),_:1},8,["dataSource","columns"])])]),a(q,{visible:o.modal.isOpen,"onUpdate:visible":n[11]||(n[11]=l=>o.modal.isOpen=l),title:e.$t(o.modal.title),width:"60%"},{footer:t(()=>[a(p,{key:"back",onClick:_.onCancelModal},{default:t(()=>[r("返回")]),_:1},8,["onClick"]),o.modal.mode=="EDIT"?(b(),k(p,{key:"Update",type:"primary",onClick:n[9]||(n[9]=l=>_.updateRecord())},{default:t(()=>[r(d(e.$t("update")),1)]),_:1})):M("",!0),o.modal.mode=="CREATE"?(b(),k(p,{key:"Store",type:"primary",onClick:n[10]||(n[10]=l=>_.storeRecord())},{default:t(()=>[r(d(e.$t("add")),1)]),_:1})):M("",!0)]),default:t(()=>[a(E,{ref:"modalRef",model:o.modal.data,name:"memberTier","label-col":{span:4},autocomplete:"off",rules:o.rules,"validate-messages":o.validateMessages},{default:t(()=>[a(u,{label:e.$t("tier"),name:"tier"},{default:t(()=>[r(d(o.modal.data.current_tier.tier_code),1)]),_:1},8,["label"]),a(g,{span:24},{default:t(()=>[a(f,{span:8},{default:t(()=>[a(u,{label:e.$t("valid_at"),"label-col":{span:12},name:"valid_at"},{default:t(()=>[r(d(o.modal.data.current_tier.valid_at),1)]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:t(()=>[a(u,{label:e.$t("expired_at"),"label-col":{span:8},name:"expired_at"},{default:t(()=>[r(d(o.modal.data.current_tier.expired_at),1)]),_:1},8,["label"])]),_:1}),a(f,{span:8},{default:t(()=>[i("img",{src:o.modal.data.avatar_url,width:"200"},null,8,P)]),_:1})]),_:1}),a(u,{label:e.$t("given_name"),name:"given_name"},{default:t(()=>[a(v,{value:o.modal.data.given_name,"onUpdate:value":n[1]||(n[1]=l=>o.modal.data.given_name=l)},null,8,["value"])]),_:1},8,["label"]),a(g,{span:24},{default:t(()=>[a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("middle_name"),name:"middle_name","label-col":{span:8}},{default:t(()=>[a(v,{value:o.modal.data.middle_name,"onUpdate:value":n[2]||(n[2]=l=>o.modal.data.middle_name=l)},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("family_name"),name:"family_name","label-col":{span:6}},{default:t(()=>[a(v,{value:o.modal.data.family_name,"onUpdate:value":n[3]||(n[3]=l=>o.modal.data.family_name=l)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),a(u,{label:e.$t("display_name"),name:"display_name"},{default:t(()=>[a(v,{value:o.modal.data.display_name,"onUpdate:value":n[4]||(n[4]=l=>o.modal.data.display_name=l)},null,8,["value"])]),_:1},8,["label"]),a(g,{span:24},{default:t(()=>[a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("gender"),name:"gender","label-col":{span:8}},{default:t(()=>[a(x,{value:o.modal.data.gender,"onUpdate:value":n[5]||(n[5]=l=>o.modal.data.gender=l),"button-style":"solid"},{default:t(()=>[a(w,{value:"M"},{default:t(()=>[r(d(e.$t("male")),1)]),_:1}),a(w,{value:"F"},{default:t(()=>[r(d(e.$t("female")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("dob"),name:"dob","label-col":{span:8}},{default:t(()=>[a(y,{value:o.modal.data.dob,"onUpdate:value":n[6]||(n[6]=l=>o.modal.data.dob=l),format:o.dateFormat,valueFormat:o.dateFormat},null,8,["value","format","valueFormat"])]),_:1},8,["label"])]),_:1})]),_:1}),a(g,{span:24},{default:t(()=>[a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("email"),name:"email","label-col":{span:8},"wrapper-col":{span:14,offset:0}},{default:t(()=>[a(v,{value:o.modal.data.email,"onUpdate:value":n[7]||(n[7]=l=>o.modal.data.email=l)},null,8,["value"])]),_:1},8,["label"])]),_:1}),a(f,{span:12},{default:t(()=>[a(u,{label:e.$t("mobile_number"),name:"mobile","label-col":{span:8}},{default:t(()=>[a(v,{value:o.modal.data.mobile,"onUpdate:value":n[8]||(n[8]=l=>o.modal.data.mobile=l)},null,8,["value"])]),_:1},8,["label"])]),_:1})]),_:1}),i("div",G,[a(p,{onClick:_.addTier},{default:t(()=>[r(d(e.$t("add"))+d(e.$t("tier")),1)]),_:1},8,["onClick"])]),i("div",j,[i("div",H,[i("table",J,[i("thead",K,[i("tr",null,[i("th",null,d(e.$t("tier")),1),i("th",Q,d(e.$t("valid_at")),1),i("th",null,d(e.$t("expired_at")),1),i("th",null,d(e.$t("operation")),1)])]),i("tbody",null,[(b(!0),c(h,null,Y(o.modal.data.tiers,(l,I)=>(b(),c("tr",null,[i("td",null,[a(u,{name:"tier_code_"+l.id,rules:[{value:l.tier_code,validator:_.validateNotNull,trigger:"blur"}]},{default:t(()=>[a(N,{name:"tier_id",value:l.tier_code,"onUpdate:value":m=>l.tier_code=m,options:C.memberTiers,fieldNames:{value:"label",label:"label"},style:{width:"200px"}},null,8,["value","onUpdate:value","options"])]),_:2},1032,["name","rules"])]),i("td",null,[a(u,{name:"valid_at_"+l.id,"wrapper-col":{span:24,offset:0},rules:[{value:l.valid_at,validator:_.validateNotNull,trigger:"blur"}]},{default:t(()=>[a(y,{value:l.valid_at,"onUpdate:value":m=>l.valid_at=m,format:o.dateFormat,valueFormat:o.dateFormat},null,8,["value","onUpdate:value","format","valueFormat"])]),_:2},1032,["name","rules"])]),i("td",null,[a(u,{name:"expired_at_"+l.id,"wrapper-col":{span:24,offset:0}},{default:t(()=>[a(y,{value:l.expired_at,"onUpdate:value":m=>l.expired_at=m,format:o.dateFormat,valueFormat:o.dateFormat},null,8,["value","onUpdate:value","format","valueFormat"])]),_:2},1032,["name"])]),i("td",W,[a(F,{title:"Are you sure delete this item?","ok-text":"Yes","cancel-text":"No",onConfirm:m=>_.deleteMemberTier(I,l)},{default:t(()=>[a(p,null,{default:t(()=>[r(d(e.$t("delete")),1)]),_:1})]),_:2},1032,["onConfirm"])])]))),256))])])])])]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["visible","title"])]),_:1},8,["title","breadcrumb"])}const re=S($,[["render",X]]);export{re as default};
