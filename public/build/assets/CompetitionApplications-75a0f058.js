import{O as T}from"./OrganizationLayout-e59c3130.js";import{M as D,b as o,ab as E,I as L,i as d,o as r,c as y,w as n,a as I,f as p,t as s,e as k,d as g,F as _}from"./app-78468d3b.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";const V={components:{OrganizationLayout:T,Modal:D,createVNode:o,ExclamationCircleOutlined:E},props:["competitionResults","competition"],data(){return{breadcrumb:[{label:"賽事列表",url:route("manage.competitions.index")},{label:"報名列表",url:null}],dateFormat:"YYYY-MM-DD",modal:{isOpen:!1,data:{},title:"Modal",mode:""},acceptDisabled:!1,columns:[{title:"Name (zh)",i18n:"name_zh",dataIndex:"name_zh",key:"name_zh"},{title:"Name (fn)",i18n:"name_fn",dataIndex:"name_fn",key:"name_fn"},{title:"Gender",i18n:"gender",dataIndex:"gender",key:"gender"},{title:"Age",i18n:"age",dataIndex:"age",key:"age"},{title:"Date of Birth",i18n:"dob",dataIndex:"dob",key:"dob"},{title:"Role",i18n:"role",dataIndex:"role",key:"role"},{title:"Category",i18n:"category",dataIndex:"category",key:"category"},{title:"Weight",i18n:"weight",dataIndex:"weight",key:"weight"},{title:"Avatar",i18n:"avatar",dataIndex:"avatar",key:"avatar"},{title:"Accepted",i18n:"competition_accepted",dataIndex:"accepted",key:"accepted",enabled:!1,width:"150px"},{title:"Result",i18n:"competition_result",dataIndex:"competition_result",key:"result",width:"150px"},{title:"Operation",i18n:"operation",dataIndex:"operation",key:"operation"}],rules:{name_fn:{required:!0},display_name:{required:!0},id_num:{required:!0},dob:{required:!0},role:{required:!0},email:{required:!0,type:"email"},mobile:{required:!0},state:{required:!0}},validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},labelCol:{style:{width:"150px"}},selectedRowKeyIds:[]}},created(){this.competitionResults.unshift({value:null,label:"---"})},methods:{onChangeGender(e){this.modal.data.category=null,this.modal.data.weight=null},onChangeCategory(e){this.modal.data.weight=null,this.genWeightList()},editRecord(e){this.modal.data={...e},this.modal.mode="EDIT",this.modal.title="Modify",this.modal.isOpen=!0,this.modal.data.gender!==""&&this.modal.data.category!==""&&this.genWeightList()},deleteRecord(e){D.confirm({title:"是否確定",icon:o(E),content:"刪除報名記錄?"+e.name_zh+" / "+e.name_fn,okText:"確定",cancelText:"取消",onOk:()=>{this.$inertia.delete(route("manage.competition.applications.destroy",{competition:this.competition.id,application:e.id}),{onSuccess:t=>{console.log(t)},onError:t=>{console.log(t)}})}})},genWeightList(){this.modal.data.gender=="M"?this.modal.data.weight_list=this.competition.categories_weights.find(e=>e.code==this.modal.data.category).male:this.modal.data.weight_list=this.competition.categories_weights.find(e=>e.code==this.modal.data.category).female},updateRecord(){this.$refs.modalRef.validateFields().then(()=>{this.$inertia.put(route("manage.competition.applications.update",{competition:this.competition.id,application:this.modal.data.id}),this.modal.data,{onSuccess:e=>{this.modal.data={},this.modal.isOpen=!1,console.log(e)},onError:e=>{console.log(e)}})}).catch(e=>{console.log("error",e)})},calculateAge(e){if(!e)return;const t=new Date;if(new Date(e)>t){var e=null,m=null;return"false"}const f=t-new Date(e),l=Math.floor(f/(1e3*60*60*24));return m=Math.floor(l/365.25),m},disabledDate(e){return e>L(new Date).subtract(3,"year")},onCheckChange(e,t){},onCheckSelect(e,t,m){t?this.selectedRowKeyIds.push(e.id):(console.log(),this.selectedRowKeyIds=this.selectedRowKeyIds.filter(f=>f!=e.id))},onCheckSelectAll(e,t,m){t.forEach(f=>{this.selectedRowKeyIds.push(f.id)})},acceptedConfirmed(e){e.accepted=!e.accepted,console.log(e.accepted),this.$inertia.put(route("manage.competition.applications.update",{competition:this.competition.id,application:e.id}),e,{onSuccess:t=>{console.log(t)},onError:t=>{console.log(t)}})},onChangeResult(e){this.$inertia.put(route("manage.competition.applications.update",{competition:this.competition.id,application:e.id}),e,{onSuccess:t=>{console.log(t)},onError:t=>{console.log(t)}})}}},W=["href"],Y=["href"],G=["href"],j=["src"],H={key:0},J={key:1},P=["src"];function Q(e,t,m,f,l,c){const R=d("a-switch"),w=d("a-button"),U=d("a-popconfirm"),M=d("a-checkbox"),v=d("a-select"),O=d("a-table"),b=d("a-input"),u=d("a-form-item"),S=d("a-radio-button"),q=d("a-radio-group"),C=d("a-col"),A=d("a-date-picker"),x=d("a-row"),K=d("a-form"),F=d("a-modal"),N=d("OrganizationLayout");return r(),y(N,{title:"報名列表",breadcrumb:l.breadcrumb},{default:n(()=>[I("a",{href:e.route("manage.competition.applications.receipts",{competition:m.competition.id,applicationIds:l.selectedRowKeyIds.toString()}),target:"_blank",class:"ant-btn"},"打印收據",8,W),I("a",{href:e.route("manage.competition.applications.export",m.competition.id),class:"ant-btn"},"滙出Excel",8,Y),o(O,{dataSource:m.competition.applications,columns:l.columns,rowSelection:{selectedRowKeys:l.selectedRowKeyIds,onChange:c.onCheckChange,onSelectAll:c.onCheckSelectAll,onSelect:c.onCheckSelect},rowKey:"id"},{headerCell:n(({column:a})=>[p(s(a.i18n?e.$t(a.i18n):a.title)+" ",1),a.dataIndex=="accepted"||a.dataIndex=="competition_result"?(r(),y(R,{key:0,checked:a.enabled,"onUpdate:checked":z=>a.enabled=z},null,8,["checked","onUpdate:checked"])):k("",!0)]),bodyCell:n(({column:a,text:z,record:i,index:X})=>[a.dataIndex=="operation"?(r(),g(_,{key:0},[I("a",{href:e.route("manage.competition.application.success",i.id),target:"_blank",class:"ant-btn"},s(e.$t("receipt")),9,G),o(w,{onClick:h=>c.editRecord(i)},{default:n(()=>[p(s(e.$t("edit")),1)]),_:2},1032,["onClick"]),o(U,{title:e.$t("confirm_delete_record")+i.name_zh+"/"+i.name_fn,"ok-text":e.$t("confirm"),"cancel-text":e.$t("aband"),onConfirm:h=>c.deleteRecord(i)},{default:n(()=>[o(w,null,{default:n(()=>[p(s(e.$t("delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])],64)):a.dataIndex=="full_name"?(r(),g(_,{key:1},[p(s(i.given_name)+" "+s(i.middle_name)+" "+s(i.family_name),1)],64)):a.dataIndex=="age"?(r(),g(_,{key:2},[p(s(c.calculateAge(i.dob)),1)],64)):a.dataIndex=="avatar"?(r(),g("img",{key:3,src:i.avatar_url,width:"60"},null,8,j)):a.dataIndex=="accepted"?(r(),y(U,{key:4,title:e.$t("sure_confirmed")+(i.accepted?e.$t("competition_unaccepted")+"?":e.$t("competition_accepted")+"?"),"ok-text":e.$t("confirm"),"cancel-text":e.$t("aband"),onConfirm:h=>c.acceptedConfirmed(i)},{default:n(()=>[o(M,{checked:i.accepted,"onUpdate:checked":h=>i.accepted=h,disabled:!a.enabled},null,8,["checked","onUpdate:checked","disabled"])]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])):a.dataIndex=="competition_result"?(r(),g(_,{key:5},[a.enabled?(r(),g("span",H,[o(v,{value:i.result_rank,"onUpdate:value":h=>i.result_rank=h,options:m.competitionResults,style:{width:"100px"},onChange:h=>c.onChangeResult(i)},null,8,["value","onUpdate:value","options","onChange"])])):i.result_rank?(r(),g("span",J,s(m.competitionResults.find(h=>h.value==i.result_rank).label)+" / "+s(m.competition.result_scores[i.result_rank]),1)):k("",!0)],64)):(r(),g(_,{key:6},[p(s(i[a.dataIndex]),1)],64))]),_:1},8,["dataSource","columns","rowSelection"]),o(F,{visible:l.modal.isOpen,"onUpdate:visible":t[16]||(t[16]=a=>l.modal.isOpen=a),title:l.modal.title,width:"60%"},{footer:n(()=>[l.modal.mode=="EDIT"?(r(),y(w,{key:"Update",type:"primary",onClick:t[14]||(t[14]=a=>c.updateRecord())},{default:n(()=>[p(s(e.$t("update")),1)]),_:1})):k("",!0),l.modal.mode=="CREATE"?(r(),y(w,{key:"Store",type:"primary",onClick:t[15]||(t[15]=a=>e.storeRecord())},{default:n(()=>[p(s(e.$t("add")),1)]),_:1})):k("",!0)]),default:n(()=>[o(K,{ref:"modalRef",model:l.modal.data,name:"Teacher","label-col":{span:4},autocomplete:"off",rules:l.rules,"validate-messages":l.validateMessages},{default:n(()=>[o(u,{label:e.$t("name_zh"),name:"name_zh"},{default:n(()=>[o(b,{value:l.modal.data.name_zh,"onUpdate:value":t[0]||(t[0]=a=>l.modal.data.name_zh=a)},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("name_fn"),name:"name_fn"},{default:n(()=>[o(b,{value:l.modal.data.name_fn,"onUpdate:value":t[1]||(t[1]=a=>l.modal.data.name_fn=a)},null,8,["value"])]),_:1},8,["label"]),o(x,{span:24},{default:n(()=>[o(C,{span:12},{default:n(()=>[o(u,{label:e.$t("display_name"),name:"display_name","label-col":{span:8}},{default:n(()=>[o(b,{value:l.modal.data.display_name,"onUpdate:value":t[2]||(t[2]=a=>l.modal.data.display_name=a)},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("email"),name:"email","label-col":{span:8}},{default:n(()=>[o(b,{value:l.modal.data.email,"onUpdate:value":t[3]||(t[3]=a=>l.modal.data.email=a)},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("gender"),name:"gender","label-col":{span:8}},{default:n(()=>[o(q,{value:l.modal.data.gender,"onUpdate:value":t[4]||(t[4]=a=>l.modal.data.gender=a),"button-style":"solid",onChange:c.onChangeGender},{default:n(()=>[o(S,{value:"M"},{default:n(()=>[p(s(e.$t("male")),1)]),_:1}),o(S,{value:"F"},{default:n(()=>[p(s(e.$t("female")),1)]),_:1})]),_:1},8,["value","onChange"])]),_:1},8,["label"])]),_:1}),o(C,{span:12},{default:n(()=>[o(u,{label:e.$t("id_num"),name:"id_num","label-col":{span:8}},{default:n(()=>[o(b,{value:l.modal.data.id_num,"onUpdate:value":t[5]||(t[5]=a=>l.modal.data.id_num=a)},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("mobile_number"),name:"mobile","label-col":{span:8}},{default:n(()=>[o(b,{value:l.modal.data.mobile,"onUpdate:value":t[6]||(t[6]=a=>l.modal.data.mobile=a)},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("dob"),name:"dob","label-col":{span:8}},{default:n(()=>[o(A,{value:l.modal.data.dob,"onUpdate:value":t[7]||(t[7]=a=>l.modal.data.dob=a),format:l.dateFormat,valueFormat:l.dateFormat},null,8,["value","format","valueFormat"])]),_:1},8,["label"])]),_:1})]),_:1}),o(x,{span:24},{default:n(()=>[o(C,{span:12},{default:n(()=>[o(u,{label:e.$t("role"),name:"role","label-col":{span:8}},{default:n(()=>[o(v,{value:l.modal.data.role,"onUpdate:value":t[8]||(t[8]=a=>l.modal.data.role=a),options:m.competition.roles},null,8,["value","options"])]),_:1},8,["label"]),l.modal.data.role=="athlete"?(r(),g(_,{key:0},[o(u,{label:e.$t("category"),"label-col":{span:8},name:"category"},{default:n(()=>[o(v,{value:l.modal.data.category,"onUpdate:value":t[9]||(t[9]=a=>l.modal.data.category=a),options:m.competition.categories_weights,fieldNames:{value:"code",label:"name"},onChange:c.onChangeCategory},null,8,["value","options","onChange"])]),_:1},8,["label"]),o(u,{label:e.$t("weight"),"label-col":{span:8},name:"weight"},{default:n(()=>[o(v,{value:l.modal.data.weight,"onUpdate:value":t[10]||(t[10]=a=>l.modal.data.weight=a),options:l.modal.data.weight_list,fieldNames:{value:"code",label:"name"}},null,8,["value","options"])]),_:1},8,["label"])],64)):k("",!0),o(u,{label:e.$t("competition_accepted"),name:"accepted","label-col":{span:8}},{default:n(()=>[o(R,{checked:l.modal.data.accepted,"onUpdate:checked":t[11]||(t[11]=a=>l.modal.data.accepted=a),"checked-children":e.$t("competition_accepted"),"un-checked-children":e.$t("competition_unaccepted")},null,8,["checked","checked-children","un-checked-children"])]),_:1},8,["label"]),o(u,{label:e.$t("competition_result"),name:"resule","label-col":{span:8}},{default:n(()=>[o(v,{value:l.modal.data.result_rank,"onUpdate:value":t[12]||(t[12]=a=>l.modal.data.result_rank=a),options:m.competitionResults,style:{width:"150px"},onChange:t[13]||(t[13]=a=>c.onChangeResult(e.record))},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),o(C,{span:12},{default:n(()=>[I("img",{src:l.modal.data.avatar_url,width:"200"},null,8,P)]),_:1})]),_:1})]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["visible","title"])]),_:1},8,["breadcrumb"])}const ne=B(V,[["render",Q]]);export{ne as default};
