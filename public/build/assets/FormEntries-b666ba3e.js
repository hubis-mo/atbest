import{O as A}from"./OrganizationLayout-e59c3130.js";import{_ as B}from"./CropperModal-92f58e74.js";import{q as Y}from"./index-d20420be.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import{J as q,i as u,o as s,c as y,w as n,f as c,t as m,a as v,b as l,d as i,F as _,h as g,e as C,k as w}from"./app-78468d3b.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";import"./UploadOutlined-e5283a52.js";const K={components:{OrganizationLayout:A,CropperModal:B,quillEditor:Y},props:["form","entries","entryColumns"],data(){return{breadcrumb:[{label:"表格列表",url:route("manage.forms.index")},{label:"表格報名",url:null}],dateFormat:"YYYY-MM-DD",selectedDisplayName:null,avatarPreview:null,formData:{},rowSelection:{},selectedItems:[],showCropModal:!1,modal:{isOpen:!1,data:{},title:"Modal",mode:""},validateMessages:{required:"必填欄位 ",types:{email:"不是有效電郵",number:"不是數字格式"},number:{range:"必須介於 ${min} 至 ${max}"}},verticalStyle:{display:"flex",height:"30px",lineHeight:"30px",width:"100%",marginLeft:"20px"}}},methods:{onChangeSelection(a,o){this.selectedItems=a},createEventAttendees(){var a={};this.entries.forEach(o=>{this.selectedItems.includes(o.id)&&o[this.selectedDisplayName]&&(a[o.id]={display_name:o[this.selectedDisplayName]})}),this.$inertia.post(route("manage.form.createEventAttendees",this.form.id),a,{onSuccess:o=>{this.modal.isOpen=!1,this.imageUrl=null,console.log("created")},onError:o=>{console.log(o)}})},setCroppedImageData(a){this.avatarPreview=a.imageUrl,this.formData[this.form.fields.find(o=>o.type=="photo").id]=a},deletePhoto(a){this.formData.delete_photo=!0,this.formData[a]=""},updateRecord(){console.log(this.formData),this.$inertia.patch(route("manage.form.entries.update",{form:this.form,entry:this.modal.data}),{fields:this.formData},{onSuccess:a=>{q.success(this.$t("update_success")),this.modal.isOpen=!1},onError:a=>{console.log(a)}})},editRecord(a){this.formData={},this.modal.data=a,this.modal.isOpen=!0,this.modal.data.records.forEach(o=>{this.form.fields.find(p=>p.id==o.form_field_id).type=="checkbox"?this.formData[o.form_field_id]=JSON.parse(o.field_value):this.formData[o.form_field_id]=o.field_value})},deleteRecord(a){this.$inertia.delete(route("manage.form.entries.destroy",{form:this.form,entry:a}),{onSuccess:o=>{q.success(this.$t("delete_success"))},onError:o=>{console.log(o)}})},getFieldValue(a){const o=this.modal.data.records.find(p=>p.form_field_id==a.id);return o?o.field_value:""}}},T=["href"],j=["href"],G={key:0},Q={key:1},W={key:2},X={key:3},Z={key:4},$={key:5},ee={key:6},te={key:7},ae={key:8},oe={key:9},re={key:10},le={key:11},se={class:"flex flex-wrap mt-4 mb-6"},ne={class:"w-full md:w-1/2 px-3"},ie={key:0},ue=["src"],de={key:1},me=["src"],ce={key:12},pe=v("p",null,"Data type undefined",-1);function _e(a,o,p,ve,t,h){const f=u("a-button"),U=u("a-popconfirm"),x=u("a-table"),k=u("a-input"),d=u("a-form-item"),S=u("a-textarea"),O=u("quill-editor"),M=u("a-radio"),F=u("a-radio-group"),I=u("a-checkbox"),N=u("a-checkbox-group"),E=u("a-select"),R=u("a-switch"),D=u("a-date-picker"),P=u("CropperModal"),V=u("a-form"),J=u("a-modal"),L=u("OrganizationLayout");return s(),y(L,{title:"表格列表",breadcrumb:t.breadcrumb},{default:n(()=>[c(m(t.selectedDisplayName)+" ",1),v("a",{href:a.route("manage.entry.export",p.form.id),class:"ant-btn"},"滙出Excel",8,T),l(x,{dataSource:p.entries,columns:p.entryColumns,"row-selection":{onChange:h.onChangeSelection,selectedRowKeys:t.selectedItems},rowKey:e=>e.id},{bodyCell:n(({column:e,text:r,record:b,index:he})=>[e.dataIndex=="operation"?(s(),i(_,{key:0},[l(f,{onClick:z=>h.editRecord(b)},{default:n(()=>[c(m(a.$t("edit")),1)]),_:2},1032,["onClick"]),v("a",{href:a.route("manage.form.entry.success",{form:p.form,entry:b.id}),target:"_blank",class:"ant-btn"},m(a.$t("receipt")),9,j),l(U,{title:a.$t("confirm_delete_record"),"ok-text":a.$t("yes"),"cancel-text":a.$t("no"),onConfirm:z=>h.deleteRecord(b)},{default:n(()=>[l(f,null,{default:n(()=>[c(m(a.$t("delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])],64)):e.dataIndex=="created_at"?(s(),i(_,{key:1},[c(m(b[e.dataIndex]),1)],64)):(s(),i(_,{key:2},[c(m(b[e.dataIndex]),1)],64))]),_:1},8,["dataSource","columns","row-selection","rowKey"]),l(J,{visible:t.modal.isOpen,"onUpdate:visible":o[4]||(o[4]=e=>t.modal.isOpen=e),title:"View Only",width:"60%"},{footer:n(()=>[l(f,{key:"back",onClick:o[3]||(o[3]=e=>t.modal.isOpen=!1)},{default:n(()=>[c(m(a.$t("cancel")),1)]),_:1}),l(f,{key:"submit",type:"primary",onClick:h.updateRecord},{default:n(()=>[c(m(a.$t("update")),1)]),_:1},8,["onClick"])]),default:n(()=>[l(V,{model:t.modal.data,ref:"formRef",name:"default",layout:"vertical","validate-messages":t.validateMessages},{default:n(()=>[(s(!0),i(_,null,g(p.form.fields,e=>(s(),i(_,{key:e.id},[p.form.require_member?(s(),i("div",G,[l(d,{label:"Member Id",name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(k,{value:a.$page.props.user.id,"onUpdate:value":o[0]||(o[0]=r=>a.$page.props.user.id=r)},null,8,["value"])]),_:2},1032,["name","rules"])])):C("",!0),e.type=="input"?(s(),i("div",Q,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(k,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="textarea"?(s(),i("div",W,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(S,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="richtext"?(s(),i("div",X,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(O,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r,style:{"min-height":"200px"}},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="radio"?(s(),i("div",Z,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(F,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r},{default:n(()=>[(s(!0),i(_,null,g(JSON.parse(e.options),r=>(s(),y(M,{key:r.id,style:w(e.direction=="H"?"":t.verticalStyle),value:r.value},{default:n(()=>[c(m(r.label),1)]),_:2},1032,["style","value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="checkbox"?(s(),i("div",$,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(N,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r},{default:n(()=>[(s(!0),i(_,null,g(JSON.parse(e.options),r=>(s(),y(I,{key:r.id,style:w(e.direction=="H"?"":t.verticalStyle),value:r.value},{default:n(()=>[c(m(r.label),1)]),_:2},1032,["style","value"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="dropdown"?(s(),i("div",ee,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(E,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r,options:JSON.parse(e.options)},null,8,["value","onUpdate:value","options"])]),_:2},1032,["label","name","rules"])])):e.type=="true_false"?(s(),i("div",te,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(R,{checked:t.formData[e.id],"onUpdate:checked":r=>t.formData[e.id]=r},null,8,["checked","onUpdate:checked"])]),_:2},1032,["label","name","rules"])])):e.type=="date"?(s(),i("div",ae,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(D,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r,format:t.dateFormat,valueFormat:t.dateFormat},null,8,["value","onUpdate:value","format","valueFormat"])]),_:2},1032,["label","name","rules"])])):e.type=="datetime"?(s(),i("div",oe,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required}]},{default:n(()=>[l(D,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r,"show-time":"",format:a.dateTimeFormat,valueFormat:a.dateTimeFormat},null,8,["value","onUpdate:value","format","valueFormat"])]),_:2},1032,["label","name","rules"])])):e.type=="email"?(s(),i("div",re,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required},{type:"email"}]},{default:n(()=>[l(k,{value:t.formData[e.id],"onUpdate:value":r=>t.formData[e.id]=r},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name","rules"])])):e.type=="photo"?(s(),i("div",le,[t.formData[e.id]?(s(),y(f,{key:1,onClick:r=>h.deletePhoto(e.id)},{default:n(()=>[c(m(a.$t("delete_photo")),1)]),_:2},1032,["onClick"])):(s(),y(f,{key:0,onClick:o[1]||(o[1]=r=>t.showCropModal=!0)},{default:n(()=>[c(m(a.$t("upload_profile_image")),1)]),_:1})),t.showCropModal?(s(),y(P,{key:2,minAspectRatioProp:{width:8,height:8},maxAspectRatioProp:{width:8,height:8},onCroppedImageData:h.setCroppedImageData,onShowModal:o[2]||(o[2]=r=>t.showCropModal=!1)},null,8,["onCroppedImageData"])):C("",!0),v("div",se,[v("div",ne,[t.avatarPreview!==null?(s(),i("div",ie,[v("img",{src:t.avatarPreview},null,8,ue)])):(s(),i("div",de,[v("img",{src:t.formData[e.id]},null,8,me)]))])])])):(s(),i("div",ce,[l(d,{label:e.field_label,name:e.id,rules:[{required:e.required},{type:"email"}]},{default:n(()=>[pe]),_:2},1032,["label","name","rules"])]))],64))),128))]),_:1},8,["model","validate-messages"])]),_:1},8,["visible"])]),_:1},8,["breadcrumb"])}const xe=H(K,[["render",_e]]);export{xe as default};
