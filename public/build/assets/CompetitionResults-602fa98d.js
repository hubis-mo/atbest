import{O as M}from"./OrganizationLayout-e59c3130.js";import{M as N,b as n,ab as S,i as h,o as d,c as f,w as l,f as u,t as r,a as s,d as _,h as C,F as y,C as W,ac as k}from"./app-78468d3b.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";const z={components:{OrganizationLayout:M,Modal:N,createVNode:n,ExclamationCircleOutlined:S},props:["competitionResults","competition"],data(){return{breadcrumb:[{label:"賽事列表",url:route("manage.competitions.index")},{label:"賽事結果",url:null}],dateFormat:"YYYY-MM-DD",selectedCategoryWeight:null,participateAthletes:[],athletes:[],columns:[{title:"Display Name",i18n:"display_name",dataIndex:"display_name"},{title:"Gender",i18n:"gender",dataIndex:"gender"},{title:"Category",i18n:"category",dataIndex:"category"},{title:"Weight",i18n:"weight",dataIndex:"weight"},{title:"Result",i18n:"result_rank",dataIndex:"result_rank"},{title:"Score",i18n:"result_score",dataIndex:"result_score"}]}},created(){this.resetParams()},mounted(){},methods:{resetParams(){this.participateAthletes=[],this.competition.applications.forEach(t=>{t.result_rank&&this.participateAthletes.push(t)}),this.selectedCategoryWeight=null,this.competitionResults.forEach(t=>{t.value=="advance"||t.value=="participate"?t.application_id=[]:t.application_id=null})},onChangeCW(){const t=this.selectedCategoryWeight.split("|");this.athletes=this.competition.applications.filter(e=>e.category==t[0]&&e.gender==t[1]&&e.weight==t[2]),this.athletes.forEach(e=>{this.competitionResults.forEach(i=>{i.value=="advance"||i.value=="participate"?i.value==e.result_rank&&(i.application_id.push(e.id),e.disabled=!0):i.value==e.result_rank&&(i.application_id=e.id,e.disabled=!0)})})},onChangeResult(t){this.athletes.forEach(e=>{e.disabled=!1}),this.competitionResults.forEach(e=>{Array.isArray(e.application_id)?e.application_id.forEach(i=>{this.athletes.find(v=>v.id==i).disabled=!0}):e.application_id&&(this.athletes.find(i=>i.id==e.application_id).disabled=!0)})},submitResult(){console.log(this.competitionResults),this.$inertia.post(route("manage.competition.results.store",{competition:this.competition}),{cgw:this.selectedCategoryWeight.split("|"),results:this.competitionResults},{onSuccess:t=>{console.log(t),this.resetParams(),this.athletes=[]},onError:t=>{console.log(t)}})}}},D=s("br",null,null,-1),O={width:"100px"},V={width:"100px"},B=["value"],F={width:"100px"},L=["value"],Y=["href"],P={class:"container mx-auto"};function G(t,e,i,v,c,m){const w=h("a-typography-title"),b=h("a-card"),g=h("a-col"),x=h("a-select"),R=h("a-row"),E=h("a-button"),A=h("a-table"),I=h("OrganizationLayout");return d(),f(I,{title:"賽事結果",breadcrumb:c.breadcrumb},{default:l(()=>[n(w,{level:4},{default:l(()=>[u(r(i.competition.title_zh),1)]),_:1}),s("p",null,[u(" 開始日期: "+r(i.competition.start_date),1),D,u(" 結束日期: "+r(i.competition.end_date),1)]),n(R,{gutter:10},{default:l(()=>[n(g,{flex:"400px"},{default:l(()=>[n(b,{title:"Categories & Weights"},{default:l(()=>[s("table",null,[(d(!0),_(y,null,C(i.competition.categories_weights,a=>(d(),_("tr",null,[s("td",O,r(a.name),1),s("td",V,[s("ol",null,[(d(!0),_(y,null,C(a.female,o=>(d(),_("li",null,[W(s("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=p=>c.selectedCategoryWeight=p),onChange:e[1]||(e[1]=(...p)=>m.onChangeCW&&m.onChangeCW(...p)),value:a.code+"|F|"+o.code},null,40,B),[[k,c.selectedCategoryWeight]]),u(" "+r(o.name),1)]))),256))])]),s("td",F,[s("ol",null,[(d(!0),_(y,null,C(a.male,o=>(d(),_("li",null,[W(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=p=>c.selectedCategoryWeight=p),onChange:e[3]||(e[3]=(...p)=>m.onChangeCW&&m.onChangeCW(...p)),value:a.code+"|M|"+o.code},null,40,L),[[k,c.selectedCategoryWeight]]),u(" "+r(o.name),1)]))),256))])])]))),256))])]),_:1})]),_:1}),n(g,{flex:"400px"},{default:l(()=>[n(b,{title:i.competition.title_zh},{extra:l(()=>[s("a",{href:t.route("manage.competition.applications.index",i.competition.id)},r(t.$t("applications")),9,Y)]),default:l(()=>[(d(!0),_(y,null,C(i.competitionResults,a=>(d(),f(R,{class:"pb-5"},{default:l(()=>[n(g,{span:6},{default:l(()=>[u(r(a.label),1)]),_:2},1024),n(g,{span:18},{default:l(()=>[a.value=="advance"||a.value=="participate"?(d(),f(x,{key:0,value:a.application_id,"onUpdate:value":o=>a.application_id=o,mode:"multiple",options:c.athletes,fieldNames:{value:"id",label:"display_name"},allowClear:!0,style:{width:"100%"},onChange:o=>m.onChangeResult(a)},null,8,["value","onUpdate:value","options","onChange"])):(d(),f(x,{key:1,value:a.application_id,"onUpdate:value":o=>a.application_id=o,options:c.athletes,fieldNames:{value:"id",label:"display_name"},allowClear:!0,style:{width:"100%"},onChange:o=>m.onChangeResult(a)},null,8,["value","onUpdate:value","options","onChange"]))]),_:2},1024)]),_:2},1024))),256)),n(E,{onClick:m.submitResult},{default:l(()=>[u("Submit")]),_:1},8,["onClick"])]),_:1},8,["title"])]),_:1}),n(g,{flex:"auto"},{default:l(()=>[s("div",P,[n(A,{dataSource:c.participateAthletes,columns:c.columns},{headerCell:l(({column:a})=>[u(r(a.i18n?t.$t(a.i18n):a.title),1)]),bodyCell:l(({column:a,text:o,record:p,index:T})=>[u(r(o),1)]),_:1},8,["dataSource","columns"])])]),_:1})]),_:1})]),_:1},8,["breadcrumb"])}const Z=U(z,[["render",G]]);export{Z as default};
