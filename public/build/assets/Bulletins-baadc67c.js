import{O as B}from"./OrganizationLayout-e59c3130.js";import{q as Y}from"./index-d20420be.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import{U as V}from"./UploadOutlined-e5283a52.js";import{R as L}from"./RestFilled-9a3a2187.js";import{J as h,i as n,o as u,c as v,w as i,a as m,b as o,f as s,t as c,d as y,F as k,e as f}from"./app-78468d3b.js";import"./DropdownLink-c7da729b.js";import"./TeamOutlined-f908f4bf.js";import"./PieChartOutlined-7a16d42c.js";import"./FormOutlined-55ddf1ad.js";const N={components:{OrganizationLayout:B,UploadOutlined:V,RestFilled:L,quillEditor:Y},props:["bulletinCategories","bulletins"],data(){return{dateFormat:"YYYY-MM-DD",yearCurrent:2023,yearStart:new Date().getFullYear()+1,yearLength:new Date().getFullYear()-2009+2,loading:!1,modal:{isOpen:!1,data:{published:1},title:"公告",mode:""},pagination:{total:this.bulletins.total,current:this.bulletins.current_page,pageSize:this.bulletins.per_page},filter:{},columns:[{title:"Title",dataIndex:"title"},{title:"Date",dataIndex:"date"},{title:"Category",dataIndex:"category"},{title:"Published",dataIndex:"published",key:"published"},{title:"Operation",dataIndex:"operation",key:"operation"}],rules:{title:{required:!0},date:{required:!0},category:{required:!0}},validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},labelCol:{style:{width:"150px"}}}},created(){},compunted:{pagination(){return{total:this.bulletins.total,current:this.bulletins.current_page,pageSize:this.bulletins.per_page}}},methods:{createRecord(e){this.modal.data={published:1},this.modal.mode="CREATE",this.modal.isOpen=!0},editRecord(e){this.modal.data={...e},this.modal.mode="EDIT",console.log(e),this.modal.isOpen=!0},storeRecord(){this.loading=!0,this.$refs.modalRef.validateFields().then(()=>{this.$inertia.post(route("admin.bulletins.store"),this.modal.data,{preserveState:!1,onSuccess:e=>{this.modal.isOpen=!1,console.log(e),h.success("新增成功")},onError:e=>{console.log(e)},onFinish:e=>{this.loading=!1}})}).catch(e=>{this.loading=!1,console.log(e)})},updateRecord(){this.$refs.modalRef.validateFields().then(()=>{this.modal.data._method="PATCH",this.$inertia.post(route("admin.bulletins.update",this.modal.data.id),this.modal.data,{preserveState:!1,onSuccess:e=>{this.modal.isOpen=!1,h.success("修改成功")},onError:e=>{console.log(e),h.error(e.error)}})}).catch(e=>{console.log("error",e)})},deleteRecord(e){this.$inertia.delete("/admin/bulletins/"+e,{preserveState:!1,onSuccess:a=>{console.log(a)},onError:a=>{alert(a.message)}})},onPaginationChange(e,a,g){this.$inertia.get(route("admin.bulletins.index"),{page:e.current,per_page:e.pageSize})}}},A=m("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Bulletins ",-1),M={class:"flex-auto pb-3 text-right"},P={class:"container mx-auto pt-5"},H={class:"bg-white relative shadow rounded-lg overflow-x-auto"},J={key:1,class:"space-x-2"},j=m("div",{style:{"margin-top":"8px"}},"Upload",-1);function G(e,a,g,K,t,r){const p=n("a-button"),x=n("a-popconfirm"),R=n("a-table"),E=n("a-select"),d=n("a-form-item"),S=n("a-date-picker"),C=n("a-input"),w=n("a-textarea"),F=n("a-switch"),O=n("upload-outlined"),U=n("a-upload"),D=n("a-form"),I=n("a-modal"),T=n("OrganizationLayout");return u(),v(T,{title:"Dashboard"},{header:i(()=>[A]),default:i(()=>[m("div",M,[o(p,{type:"primary",class:"!rounded",onClick:a[0]||(a[0]=l=>r.createRecord())},{default:i(()=>[s("Create Buletin")]),_:1})]),m("div",P,[m("div",H,[o(R,{dataSource:g.bulletins.data,columns:t.columns,pagination:t.pagination,onChange:r.onPaginationChange,ref:"dataTable"},{headerCell:i(({column:l})=>[s(c(l.i18n?e.$t(l.i18n):l.title),1)]),bodyCell:i(({column:l,text:q,record:b,index:Q})=>[l.key=="published"?(u(),y(k,{key:0},[s(c(b.published==1?"Yes":"No"),1)],64)):f("",!0),l.dataIndex=="operation"?(u(),y("div",J,[o(p,{onClick:_=>r.editRecord(b)},{default:i(()=>[s(c(e.$t("edit")),1)]),_:2},1032,["onClick"]),o(x,{title:e.$t("confirm_delete_record"),"ok-text":e.$t("yes"),"cancel-text":e.$t("no"),onConfirm:_=>r.deleteRecord(b.id)},{default:i(()=>[o(p,null,{default:i(()=>[s(c(e.$t("delete")),1)]),_:1})]),_:2},1032,["title","ok-text","cancel-text","onConfirm"])])):l.dataIndex=="category"?(u(),y(k,{key:2},[s(c(g.bulletinCategories.find(_=>_.value==q).label),1)],64)):f("",!0)]),_:1},8,["dataSource","columns","pagination","onChange"])])]),o(I,{visible:t.modal.isOpen,"onUpdate:visible":a[10]||(a[10]=l=>t.modal.isOpen=l),title:t.modal.mode=="CREATE"?"Create":"Edit",width:"60%"},{footer:i(()=>[t.modal.mode=="EDIT"?(u(),v(p,{loading:t.loading,key:"Update",type:"primary",onClick:a[8]||(a[8]=l=>r.updateRecord())},{default:i(()=>[s("修改")]),_:1},8,["loading"])):f("",!0),t.modal.mode=="CREATE"?(u(),v(p,{loading:t.loading,key:"Store",type:"primary",onClick:a[9]||(a[9]=l=>r.storeRecord())},{default:i(()=>[s("新增")]),_:1},8,["loading"])):f("",!0)]),default:i(()=>[o(D,{ref:"modalRef",model:t.modal.data,"label-col":{span:4},"wrapper-col":{span:20},rules:t.rules,"validate-messages":t.validateMessages},{default:i(()=>[o(d,{label:e.$t("category"),name:"category"},{default:i(()=>[o(E,{value:t.modal.data.category,"onUpdate:value":a[1]||(a[1]=l=>t.modal.data.category=l),options:g.bulletinCategories},null,8,["value","options"])]),_:1},8,["label"]),o(d,{label:e.$t("date"),name:"date"},{default:i(()=>[o(S,{value:t.modal.data.date,"onUpdate:value":a[2]||(a[2]=l=>t.modal.data.date=l),format:t.dateFormat,valueFormat:t.dateFormat},null,8,["value","format","valueFormat"])]),_:1},8,["label"]),o(d,{label:e.$t("title"),name:"title"},{default:i(()=>[o(C,{value:t.modal.data.title,"onUpdate:value":a[3]||(a[3]=l=>t.modal.data.title=l)},null,8,["value"])]),_:1},8,["label"]),o(d,{label:e.$t("description"),name:"description"},{default:i(()=>[o(C,{value:t.modal.data.description,"onUpdate:value":a[4]||(a[4]=l=>t.modal.data.description=l)},null,8,["value"])]),_:1},8,["label"]),o(d,{label:e.$t("content"),name:"content"},{default:i(()=>[o(w,{value:t.modal.data.content,"onUpdate:value":a[5]||(a[5]=l=>t.modal.data.content=l)},null,8,["value"])]),_:1},8,["label"]),o(d,{label:e.$t("published"),name:"published"},{default:i(()=>[o(F,{checked:t.modal.data.published,"onUpdate:checked":a[6]||(a[6]=l=>t.modal.data.published=l),unCheckedValue:0,checkedValue:1},null,8,["checked"])]),_:1},8,["label"]),o(d,{label:e.$t("image"),name:"images"},{default:i(()=>[o(U,{"file-list":t.modal.data.images,"onUpdate:fileList":a[7]||(a[7]=l=>t.modal.data.images=l),"list-type":"picture-card",beforeUpload:()=>!1},{default:i(()=>[m("div",null,[o(O),j])]),_:1},8,["file-list"])]),_:1},8,["label"])]),_:1},8,["model","rules","validate-messages"])]),_:1},8,["visible","title"])]),_:1})}const ne=z(N,[["render",G]]);export{ne as default};
